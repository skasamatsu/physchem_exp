# プログラミングの基本

## 変数と型

プログラミングでは、「変数」に「値（データ）」を代入して、再利用することができる。

```python
### 例1 変数の利用

a = 10      # 変数aに値10を代入
b = 20      # 変数bに値20を代入
c = a * b   # 変数cにaとbを掛け合わせた結果を代入
print(a,b,c)    # => 10 20 200
a = a + b   # 変数aにaとbを足した結果を代入
print(a,b,c)    # => 30 20 100 (元のaの値は上書きされる)
a + b = c   # => SyntaxError
```

勘違いしがちだが、`=`は数学的な等号を意味するわけではない。あくまで、左辺の変数に右辺の値を代入するという操作を表す。なので、`a + b = c`はエラーになる。

ちなみに`#`の後に書かれている内容はプログラムを実行するときは無視される。これをコメント文と呼ぶ。後でプログラムを見直したときに、そこでどのような処理を行っているかが分かりやすいようにメモするために使われる。実習時は入力する必要はない。また、このノートでは`# =>`で、実行結果を示す。

定義されていない（値が代入されていない）変数は使えない。使おうとするとエラーが出る。

```python
### 例2 未定義変数を使おうとすると…

a = 10
b = 20
print(d) # => NameError: name 'd' is not defined
```

ちなみに、エラーを恐れないで欲しい。実験とは違って、プログラミング実習ではミスしても事故が起こったりはしない（ロボットを制御したりロケットを飛ばすときはそういうわけにはいかないが…）。エラーを見てどんどん修正をしていく方が生産性が高くなりやすい。

pythonで扱う値には「型」がある。例えば整数とか文字列とかいった具合である。`type`という命令で値の型を確認できる。

```python
### 例3 値の型

print(type(10))         # => <class 'int'>
print(type(10.0))       # =>  <class 'float'>
print(type('hello'))    # =>  <class 'str'>
```

'int'はinteger（整数）、'str'はstring（文字列）の略である。
'float'はfloating point number（浮動小数点数）で、実数をコンピュータ上で近似的に表すための型である。
クオーテーションマーク（ダブルクオーテーションマークでもＯＫ）で囲んだ値はすべて'str'になる。

```python
### 例4 数字でも’’で囲うと文字列になる

print(type('10.0'))     # => <class 'str'>
```

型によって、その値を使ってできる演算やその結果が異なる。

```python
### 例5 型と演算

# intの場合
print(3+5)  # => 8
print(3*5)  # => 15
print(3-5)  # => -2
print(3/5)  # => 0.6 ('/'を使った割り算の結果はfloatになる)
print(3//5) # => 0

# floatの場合
print(3.0+5.0)  # => 8.0
print(3.0*5.0)  # => 15.0
print(3.0-5.0)  # => -2.0
print(3.0/5.0)  # => 0.6 
print(5.0/3.0)  # => 1.6666666666666667 (浮動小数点数は近似値)
print(3.0//5.0) # => 0.0

# 文字列の場合
print('3'+'5')  # => '35'
# 以下は全てTypeErrorになる
print('3'*'5')  
print('3'-'5')  
print('3'/'5')  
print('3'//'5') 
```

異なる型同士の演算ができる場合もある。例えば文字列と整数のかけ算ができる。

```python
### 例6 異なる型同士の演算

# どうなるか確認してみよう
print(3*5.0) # 整数 × float
print('3'*5) # 文字列 × 整数
```

変数にも型が定義されている。pythonの場合は、変数に代入した瞬間にその変数の型が決まる。`type`という命令で変数や値の型を確認できる。ちなみに、プログラミング言語によっては、代入する前に変数ごとに型を定義しなければならないものもある。

```python
### 例7 変数の型

a = 10
print(type(a)) # =>  <class 'int'>
a = 10.0
print(type(a)) # =>  <class 'float'>
a = '10'
print(type(a)) # =>  <class 'str'>
```

pythonでは、複数の値を格納することのできる「リスト」という型がある。異なる型の値を同じリストに格納できる。個々の値には番号を指定することでアクセスできる(pythonでは0からスタート)。また、リストには作成した後に要素を追加することができる。

```python
### 例8　リストの定義と利用

a = [1, '2', 3.0]
print(a)    # [1, '2', 3.0]
print(a[0]) # => 1
print(a[1]) # => '2'
print(a[2]) # => 3.0
```

```python
### 例9 リストへの要素の追加

b = [] # 空リストの定義
b.append(0)         # リストに整数値0を追加
b.append(1)         # リストに整数値1を追加
b.append(2)         # リストに整数値2を追加
b.append('hello')   # リストに文字列'hello'を追加
print(b)            # => [0, 1, 2, 'hello']
```

## 条件分岐、ブロック

プログラムは基本的に1行ごとに順番に実行される。
変数の値によってその先の制御が異なる場合は、条件分岐命令if..else を使って交通整理する。

```python
### 例10 条件分岐

# 以下のa, bの値を様々に変えて実行せよ。
a = 10
b = 5
if a >= b: 
    # aがb以上ならば
    print(a, 'は', b, '以上である')
else:
    # それ以外の場合
    print(a, 'は', b, '未満である')
```

`if a >= b:`の次の行からは、`a >= b`が成り立つ場合に実行されるプログラムのカタマリ（ブロック）をインデントして記入する。同じブロックでインデントがズレるとエラーになる。

```python
### 例11 インデントエラー

print('hello')
    print('world') # => IndentationError
```

### 課題 1 (条件分岐)

例10を改変することで、二次方程式ax<sup>2</sup> + bx + c = 0 の解を判別し、実数解なら解を求め、虚数解なら
Kyosuu-kai!!と表示するプログラムを作成せよ（判別式を使って条件分岐させる）。

## 繰り返し

大量のデータの平均値を求めるなどの統計的な計算は、コンピュータの最も得意とする処理といって良い。この時、繰り返し命令やリストが威力を発揮する。

例えば、10 人に対して行った試験の平均点を求めるプログラムは以下のように書ける。

```python
### 例12 平均点の計算

tokuten = [50, 92, 78, 32, 10, 60, 88, 36, 75, 62] # 得点リスト
gokeiten = 0        # 最初に合計を0にしておく
n = len(tokuten)    # len()でリストの長さ(人数)を取得
for i in range(n):  # iを0からn-1まで1ずつ増加させながら…
    print(i,'番の得点は',tokuten[i])   # 得点を1人ずつ表示
    gokeiten = gokeiten + tokuten[i] # 得点を順次足し込む
heikinten = gokeiten / n    # 平均点の計算
print('合計= ', gokeiten)    # 合計点の表示
print('平均= ', heikinten)   # 平均点の表示
```

------------------------------------------------

### 課題2 (繰り返し)

ある試験問題の正答率の標準偏差を計算するプログラムを作成せよ。標準偏差とは、値のばらつきの指標であり、平均値$\bar{x}$を求めたうえで、以下の式で求められる。

$\bar{s} = \sqrt{1/n \sum{(x_i - \bar{x})^2}}$

| 設問番号 | 1 | 2 |  3 | 4 | 5 | 6 | 7 | 8 | 
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 正答率  | 67.5 | 90.2 | 13.7 | 84.1 | 45.6 | 42.2 | 65.0 | 57.6|

------------------------------------------------

## 関数の定義と利用

すでに書いたプログラムを再利用するために便利なのが「関数」である。
関数は`def 関数名(引数):`の下のブロックに処理内容を書く（引数については後で説明する）。

```python
### 例13 関数の定義と利用

def sayhi():
    print('Hi!')

for i in range(10):
    sayhi()
# => 10回挨拶される
```

関数にインプットを与えることもできる。これを引数（ひきすう）と呼ぶ。以下の例では`s`が引数である。

```python
### 例14 引数を取る関数の定義と利用

def say(s):
    print(s)

for i in range(10):
    say(i)
    say('hello!')
    say('bye!')
```

また、実行した結果として、値を返すこともできる。`return`という命令を使う。関数が返した値を変数に代入することもできる。

```python
### 例15 戻り値を返す関数の定義と利用

def add(a,b):
    return a+b
c = add(3,5)
print(c)        # => 8
```

これを応用すると、得点リストを引数として受け取って平均点と合計点を計算する関数を以下のように書ける。

```python
### 例16 平均点を計算する関数の定義と利用

def gokei_heikin(tokuten): # tokutenを引数として受け取る
    gokeiten = 0        # 最初に合計を0にしておく
    n = len(tokuten)    # len()でリストの長さ(人数)を取得
    for i in range(n):  # iを0からn-1まで1ずつ増加させながら…
        print(i,'番の得点は',tokuten[i])   # 得点を1人ずつ表示
        gokeiten = gokeiten + tokuten[i] # 得点を順次足し込む
    heikinten = gokeiten / n    # 平均点の計算
    return gokeiten, heikinten  # 合計点と平均点を返す

tokuten = [50, 92, 78, 32, 10, 60, 88, 36, 75, 62]
gokeiten, heikinten = gokei_heikin(tokuten) # 関数gokei_heikinを呼び出し、結果をgokeiten, heikintenに代入
print('合計= ', gokeiten)    # 合計点の表示
print('平均= ', heikinten)   # 平均点の表示
```

なお、一度定義した関数は、別のセルでも利用可能である。

------------------------------------------------

### 課題3-1 (関数の定義と利用)

tokutenを引数として取り、標準偏差を計算する関数を作成し、正しく動作することを確認せよ。

------------------------------------------------

リストを戻り値とすることもできる。
例えば、フィボナッチ数列
( $a_0 = 1$,
$a_1 = 2$,
$a_n = a_{n-1} + a_{n-2}$で定義される数列)を
計算したリストを返す関数は以下のように書くことができる。

```python
### 例 長さnのフィボナッチ数列のリストを返す関数

def fibonacci(n):
    fib = [1,2]
    for i in range(2,n): #(i=2,3,...n-1で繰り返す)
        fib.append(fib[i-1] + fib[i-2])
    return fib

fib10 = fibonacci(10)
print(fib10)
```
------------------------------------------------

### 課題3-2 (リストを返す関数)

tokutenを引数として取り、各生徒の偏差値をリストとして返す関数を作成し、正しく動作することを確認せよ。
なお、 $i$ 番目の生徒の得点 $x_i$ に対する偏差値 $T_i$ は、標準偏差 $\bar{s}$ を使って次の式で定義される

$T_i = 10 (x_i - \bar{x}) / \bar{s} +50$

------------------------------------------------

## ライブラリ関数の利用

pythonでは、関数などのよく使う機能をパッケージ化し、別のプログラムから呼び出すことで再利用することができる。パッケージ化された機能群のことをライブラリと呼んだりする。例えば、三角関数やその逆関数は以下のように呼び出して利用できる。

```python
from numpy import cos, sin, arcsin, arccos, pi

print(pi) # => 3.14....
print(sin(pi)) # => 1.2246467991473532e-16
print(cos(pi)) # => -1.0
print(sin(pi/2)) # => 1.0
print(cos(pi/2)) # => 6.123233995736766e-17
print(arccos(0.5)*3) # => 3.14....
```

1行目でnumpyライブラリからcos, sin, arcsin, arccosという関数と、円周率の値が代入済みのpiという変数を読み込んでいる。なお、このライブラリ関数に入力する角度は全てラジアン単位である。読み込んだライブラリ関数を使って新しい関数を定義することもできる。例えば、ラジアンではなく角度から三角関数を計算する関数は下記のように定義できる。

```python
from numpy import cos, sin

def sin_degree(theta):
    return sin(theta * pi / 180)

def cos_degree(theta):
    return cos(theta * pi / 180)
```

------------------------------------------------

### 課題4　(ライブラリ関数の利用)

三角形の2辺の長さ $a$ 、 $b$ とその挟む角 $\theta$ (theta) が与えられた時、
残りの１辺の長さ $c$ を求め表示する関数を作ってみよう
（ヒント）余弦定理より $c^2 = a^2 + b^2 −2ab cos \theta$ 。 $a^2$ の計算は `a**2` 又は `a*a` と書く。 $\sqrt{x}$ の計算は ``x**0.5`` 。

------------------------------------------------

## グラフの描画

pythonではグラフを描画するためのライブラリも用意されている。

```python
### 例 線グラフの描画

import matplotlib.pyplot as plt # プロット用のライブラリの読み込み

# x座標のリスト
x = [0.10074672, 0.42531284, 0.4977619, 0.51249437, 0.55442276, 0.6462995, 0.71533244, 0.82155014, 0.94775606, 0.96897035]

# y座標のリスト
y = [0.48882294, 0.01068621, 0.08487254, 0.04088802, 0.67926903, 0.53511043, 0.11916897, 0.18302312, 0.12861041, 0.05824681]

# プロットコマンド。色や線種、記号を変えられる。
plt.plot(x,y, color = 'blue', marker = '^', linestyle='--')
```

------------------------------------------------

### 課題5-1　(グラフの描画1)

上記の例で、 $x$ 座標や $y $座標を変更すると、
プロットされるグラフが変わることを確認せよ。

------------------------------------------------

これ以外にも様々なグラフ関連の関数が用意されている（？？？参照）。ここでは、以後の実習で利用する、x軸、y軸に平行な線を引くための関数を紹介しておく。

```python
# 例 鉛直線と水平線

# x = 0.5で、y = 0 から　y = 1まで鉛直線を引く
plt.axvline(0.5, 0, 1, color='blue', linestyle='-') 

# y = 0.5で、x = 0.25からx = 0.75まで水平線を引く
plt.axhline(0.5, 0.25, 0.75, color='orange', linestyle='--')
```

繰り返しを使って複数の線を引くこともできる。

```python
x_list  = [1,2,3,4,5,6,7]
for x in x_list:
    plt.axvline(x)
```

------------------------------------------------

### 課題5-2　（グラフの描画2）

フィボナッチ数列{1,2,3,5,8,13...}に対応するx座標に垂線を引け。
ヒント: 上の例の `x_list` に例？で作った関数 `fib(n)` (`n` は適当な整数) を
代入すれば良い。

------------------------------------------------

## ブラッグ回折

ミラー指数hklと、hkl回折線が現れる角度$\theta$との関係は

$\sin^2 \theta = \lambda^2  (h^2+k^2+l^2) / (4a^2)$

である。ここで、

$0 \leq \sin^2 \theta \leq 1$

から、右辺が1以下となる範囲のhklでブラッグ反射が観測される。$\theta$に対して解くと、

$\theta = \arcsin(\lambda \sqrt{h^2+k^2+l^2}/(2a))$

となる。ここで、arcsinはsin関数の値から角度を逆算する関数である。つまり、
$\sin \theta = x$ のとき、 $\arcsin(x) = \theta$ である。

## Ｘ線回折を使った物質の同定

### 課題 理論的な回折角の計算

８種類の候補結晶それぞれに対してブラッグ回折が起こる角度 $\theta$
を計算する関数を作成せよ。

- 面心立方とダイヤモンド型立方に分けて関数を作ると良い（同じ結晶系ならばミラー指数の組は同じで格子定数だけが違う）。
- 格子定数を引数に取って計算に使うように関数を作れば、同じ結晶系なら関数を再利用できる。
- 表3-1左欄にある $h^2+k^2+l^2$の値のリストを引数に取って、それぞれの値に対して$\theta=\arcsin(\lambda\sqrt{h^2+k^2+l^2}/(2a))$を計算し、結果をリストに入れてreturnする。
- 角度はラジアン単位から度に変換することを忘れないように。

### 課題 物質の同定

課題？で作ったそれぞれの物質の$\theta$リストをX線回折データに重ねて、物質を同定せよ。以下のコードを参考にせよ。

```python
import numpy as np # 数値データを扱うためのnumpyライブラリ
import matplotlib.pyplot as plt # プロット用のライブラリの読み込み

# 回折データの読み込み
xrd_dat = np.loadtxt('AgBr-01.txt',skiprows=1)
theta = xrd_dat[:,0]
intensity = xrd_dat[:,1]

# 回折データのプロット
plt.plot(theta, intensity)

# ここに課題？で作ったthetaのリストをplt.axvlineを使ってプロット
theta_list = 【課題で作った関数】
for theta in theta_list:
    plt.axvline(theta*2)
```

上で利用しているnumpyというライブラリは、多次元配列を効率的に扱うためのライブラリである。
np.loadtxtで2次元の配列（行列）としてX線回折データを`xrd_dat`に代入し、その1列目(角度)を`theta`に、2列目（回折強度）を`intensity`に代入している。このデータをプロットし、さらに、課題?で作った物質ごとの回折角のデータを重ねることで、物質を同定する。

------------------------------------------------

### 課題6-5 指数付け

X線チャートに、物質名とミラー指数を鉛筆で書き込め（例：NaCl 200 など）

------------------------------------------------

### 課題 格子定数の計算

scipyというライブラリのfind_peaks関数を使うと、１次元配列から極大となる要素の番号を取ってくることができる。

```python
from scipy.signal import find_peaks

# 回折データの読み込みとプロット
xrd_dat = np.loadtxt('AgBr-01.txt',skiprows=1)
theta = xrd_dat[:,0]
intensity = xrd_dat[:,1]
plt.plot(theta, intensity)

# ピーク位置の自動検出
peak_ids, props = find_peaks(xrd_intensity,height=【ピークの最小高さ】, distance=【ピーク間の最小距離】)

# 検出したピーク位置のプロット
peak_angles = []
for i in peak_ids:
  plt.axvline(theta[i],color='orange')
  print('Peak position', i, theta[i])
  peak_angles.append(theta[i])
```

heightとdistanceの値を調整して、X線回折データのピーク位置が検出できることを確認せよ。検出したピーク位置と対応するミラー指数から、格子定数を計算せよ。ピークごとに格子定数が求まるので、それらの平均と標準偏差を計算せよ。
